<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>让Node.js程序稳定运行 | Mustang Blog</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.2.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.2.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">让Node.js程序稳定运行</h1><a id="logo" href="/.">Mustang Blog</a><p class="description">天行健，君子以自强不息；地势坤，君子以厚德载物</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">让Node.js程序稳定运行</h1><div class="post-meta">Feb 25, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h2 id="How-to-make-the-node-js-application-run-stably"><a href="#How-to-make-the-node-js-application-run-stably" class="headerlink" title="How to make the node.js application run stably"></a>How to make the node.js application run stably</h2><p>Node.js程序在越来越多的公司部署在生产环境，程序的稳定运行逐渐被大家所关注。下面我就分享一下这方面的经验，仅供参考。</p>
<h2 id="一、捕获错误"><a href="#一、捕获错误" class="headerlink" title="一、捕获错误"></a>一、捕获错误</h2><h3 id="try-语句"><a href="#try-语句" class="headerlink" title="try 语句"></a>try 语句</h3><p>try语句捕获错误是Javascript在网页或服务器上最常见也是最简单的捕获错误方式。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">	<span class="comment">// 业务代码</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">catch</span>(e) &#123;</div><div class="line">	<span class="comment">// 异常时执行的代码</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">finally</span> &#123;</div><div class="line">	<span class="comment">// 最后执行的代码</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这种方式适用于当前执行的代码，语法错误，变量使用异常等情况的异常捕获。但是对于函数、对象里的异常，是无法捕获的。比如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> testVar;</div><div class="line"></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">	<span class="keyword">var</span> testFun = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(testVar.toString());</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">catch</span>(e) &#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"run catch"</span>, e);</div><div class="line">&#125;</div><div class="line"><span class="keyword">finally</span> &#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"run finally"</span>);</div><div class="line">&#125;</div><div class="line">testFun();</div></pre></td></tr></table></figure></p>
<p>如果你们觉得会运行“console.log(testVar.toString())”时捕获到变量未初始化，那就错了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> yuenshui@yuenshuideMacBook-Pro ~/Documents/website/nodejs&gt; node <span class="built_in">test</span>001.js</div><div class="line">run finally</div><div class="line">/Users/yuenshui/Documents/website/nodejs/<span class="built_in">test</span>001.js:9</div><div class="line">       		console.log(<span class="built_in">test</span>Var.toString());</div><div class="line">       		                   ^</div><div class="line"></div><div class="line">TypeError: Cannot <span class="built_in">read</span> property <span class="string">'toString'</span> of undefined</div><div class="line">    at <span class="built_in">test</span>Fun (/Users/yuenshui/Documents/website/nodejs/<span class="built_in">test</span>001.js:9:29)</div><div class="line">    at Object.&lt;anonymous&gt; (/Users/yuenshui/Documents/website/nodejs/<span class="built_in">test</span>001.js:19:1)</div><div class="line">    at Module._compile (module.js:409:26)</div><div class="line">    at Object.Module._extensions..js (module.js:416:10)</div><div class="line">    at Module.load (module.js:343:32)</div><div class="line">    at Function.Module._load (module.js:300:12)</div><div class="line">    at Function.Module.runMain (module.js:441:10)</div><div class="line">    at startup (node.js:139:18)</div><div class="line">    at node.js:968:3</div></pre></td></tr></table></figure></p>
<p>程序执行到这里就会闪退(Crash)。</p>
<p>解决办法是，在执行的地方捕获错误。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> testVar;</div><div class="line"></div><div class="line"><span class="keyword">var</span> testFun = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(testVar.toString());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">	testFun();</div><div class="line">&#125;</div><div class="line"><span class="keyword">catch</span>(e) &#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"run catch"</span>, e);</div><div class="line">&#125;</div><div class="line"><span class="keyword">finally</span> &#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"run finally"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yuenshui@yuenshuideMacBook-Pro ~/Documents/website/nodejs&gt; node <span class="built_in">test</span>001.js</div><div class="line">run catch [TypeError: Cannot <span class="built_in">read</span> property <span class="string">'toString'</span> of undefined]</div><div class="line">run finally</div></pre></td></tr></table></figure></p>
<h3 id="类型判断"><a href="#类型判断" class="headerlink" title="类型判断"></a>类型判断</h3><p>如上例，只要在使用变量前加上类型判断，就不会出现程序异常。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> testVar;</div><div class="line"></div><div class="line"><span class="keyword">var</span> testFun = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span>(<span class="keyword">typeof</span> testVar != <span class="string">'undefined'</span>) &#123;</div><div class="line">		<span class="built_in">console</span>.log(testVar.toString());</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">testFun();</div></pre></td></tr></table></figure></p>
<p>像这样的情况，一般的熟手都能做的很好，不用依赖try捕获异常来保证稳定运行。</p>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>如果认为上面两个例子通过判断类型避免异常和try语句捕获异常就能解决异常的出现，那就错误。因为还有异步的存在（^_^ 天刹的异步），异步执行的代码中如果产生异常，调用阶段使用try是没意义的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> <span class="built_in">Promise</span> = <span class="built_in">require</span>(<span class="string">"bluebird"</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> testFun = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">	fs.readFile(<span class="string">"./abc.bin"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</div><div class="line">	&#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">	testFun(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(data);</div><div class="line">	&#125;);</div><div class="line">&#125;</div><div class="line"><span class="keyword">catch</span>(e) &#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"run catch"</span>, e);</div><div class="line">&#125;</div><div class="line"><span class="keyword">finally</span> &#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"run finally"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">yuenshui@yuenshuideMacBook-Pro ~/Documents/website/nodejs&gt; node <span class="built_in">test</span>013.js                            </div><div class="line">module.js:327</div><div class="line">    throw err;</div><div class="line">    ^</div><div class="line"></div><div class="line">Error: Cannot find module <span class="string">'/Users/yuenshui/Documents/website/nodejs/test013.js'</span></div><div class="line">    at Function.Module._resolveFilename (module.js:325:15)</div><div class="line">    at Function.Module._load (module.js:276:25)</div><div class="line">    at Function.Module.runMain (module.js:441:10)</div><div class="line">    at startup (node.js:139:18)</div><div class="line">    at node.js:968:3</div></pre></td></tr></table></figure></p>
<p>异步下可以使用Promise捕获：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> <span class="built_in">Promise</span> = <span class="built_in">require</span>(<span class="string">"bluebird"</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> testFun = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line">		fs.readFile(<span class="string">"./test.txt"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">			<span class="keyword">if</span>(err) reject(err);</div><div class="line">			<span class="keyword">else</span> &#123;</div><div class="line">				resolve(data);</div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line">	&#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">testFun()</div><div class="line">	.then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"then:"</span>, data.toString());</div><div class="line">	&#125;)</div><div class="line">	.catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"catch:"</span>, err);</div><div class="line">	&#125;);</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yuenshui@yuenshuideMacBook-Pro ~/Documents/website/nodejs/chat&gt; node <span class="built_in">test</span>015.js</div><div class="line">catch: &#123; [Error: ENOENT: no such file or directory, open <span class="string">'./test.txt'</span>] errno: -2, code: <span class="string">'ENOENT'</span>, syscall: <span class="string">'open'</span>, path: <span class="string">'./test.txt'</span> &#125;</div></pre></td></tr></table></figure></p>
<h3 id="使用domain"><a href="#使用domain" class="headerlink" title="使用domain"></a>使用domain</h3><p>这是官方给的一个例子，在用domain创建的域里执行程序，将会捕获到程序的错误。<br>官方给的解释是：domain提供了将多个不同IO操作作为单个组处理的方式。如果任何注册到域的事件发射器或回调函数发出“error”事件或者抛出一个错误，那么将通知域对象，而不是直接让这个错误的上下文从process.on(‘uncaughtException’)处理程序中丢失掉，甚至程序立即退出并显示错误代码。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> d = <span class="built_in">require</span>(<span class="string">'domain'</span>).create();</div><div class="line">d.on(<span class="string">'error'</span>, (er) =&gt; &#123;</div><div class="line">  <span class="comment">// The error won't crash the process, but what it does is worse!</span></div><div class="line">  <span class="comment">// Though we've prevented abrupt process restarting, we are leaking</span></div><div class="line">  <span class="comment">// resources like crazy if this ever happens.</span></div><div class="line">  <span class="comment">// This is no better than process.on('uncaughtException')!</span></div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'error, but oh well'</span>, er.message);</div><div class="line">&#125;);</div><div class="line">d.run(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</div><div class="line">    handleRequest(req, res);</div><div class="line">  &#125;).listen(PORT);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="uncaughtException-事件"><a href="#uncaughtException-事件" class="headerlink" title="uncaughtException 事件"></a>uncaughtException 事件</h3><p>通过process的uncaughtException事件，来处理未捕获的异常。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">process.on(<span class="string">'uncaughtException'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'catch fatal error: '</span> + err.stack || err);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h2 id="二、进程守护"><a href="#二、进程守护" class="headerlink" title="二、进程守护"></a>二、进程守护</h2><h3 id="pm2"><a href="#pm2" class="headerlink" title="pm2"></a>pm2</h3><p>官网：<a href="http://pm2.keymetrics.io/" target="_blank" rel="external">http://pm2.keymetrics.io/</a><br>PM2是一个进程管理器，在进程闪退后立即重启该进程，起到了守护作用，并且记录error_log，用于错误分析。<br>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g pm2</div></pre></td></tr></table></figure></p>
<p>用法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">$ npm install pm2 -g     <span class="comment"># 命令行安装 pm2 </span></div><div class="line">$ pm2 start app.js -i 4 <span class="comment">#后台运行pm2，启动4个app.js </span></div><div class="line">                                <span class="comment"># 也可以把'max' 参数传递给 start</span></div><div class="line">                                <span class="comment"># 正确的进程数目依赖于Cpu的核心数目</span></div><div class="line">$ pm2 start app.js --name my-api <span class="comment"># 命名进程</span></div><div class="line">$ pm2 list               <span class="comment"># 显示所有进程状态</span></div><div class="line">$ pm2 monit              <span class="comment"># 监视所有进程</span></div><div class="line">$ pm2 logs               <span class="comment">#  显示所有进程日志</span></div><div class="line">$ pm2 stop all           <span class="comment"># 停止所有进程</span></div><div class="line">$ pm2 restart all        <span class="comment"># 重启所有进程</span></div><div class="line">$ pm2 reload all         <span class="comment"># 0秒停机重载进程 (用于 NETWORKED 进程)</span></div><div class="line">$ pm2 stop 0             <span class="comment"># 停止指定的进程</span></div><div class="line">$ pm2 restart 0          <span class="comment"># 重启指定的进程</span></div><div class="line">$ pm2 startup            <span class="comment"># 产生 init 脚本 保持进程活着</span></div><div class="line">$ pm2 web                <span class="comment"># 运行健壮的 computer API endpoint (http://localhost:9615)</span></div><div class="line">$ pm2 delete 0           <span class="comment"># 杀死指定的进程</span></div><div class="line">$ pm2 delete all         <span class="comment"># 杀死全部进程</span></div><div class="line"></div><div class="line">运行进程的不同方式：</div><div class="line">$ pm2 start app.js -i max  <span class="comment"># 根据有效CPU数目启动最大进程数目</span></div><div class="line">$ pm2 start app.js -i 3      <span class="comment"># 启动3个进程</span></div><div class="line">$ pm2 start app.js -x        <span class="comment">#用fork模式启动 app.js 而不是使用 cluster</span></div><div class="line">$ pm2 start app.js -x -- <span class="_">-a</span> 23   <span class="comment"># 用fork模式启动 app.js 并且传递参数 (-a 23)</span></div><div class="line">$ pm2 start app.js --name serverone  <span class="comment"># 启动一个进程并把它命名为 serverone</span></div><div class="line">$ pm2 stop serverone       <span class="comment"># 停止 serverone 进程</span></div><div class="line">$ pm2 start app.json        <span class="comment"># 启动进程, 在 app.json里设置选项</span></div><div class="line">$ pm2 start app.js -i max -- <span class="_">-a</span> 23                   <span class="comment">#在--之后给 app.js 传递参数</span></div><div class="line">$ pm2 start app.js -i max <span class="_">-e</span> err.log -o out.log  <span class="comment"># 启动 并 生成一个配置文件</span></div><div class="line">你也可以执行用其他语言编写的app  ( fork 模式):</div><div class="line">$ pm2 start my-bash-script.sh    -x --interpreter bash</div><div class="line">$ pm2 start my-python-script.py -x --interpreter python</div></pre></td></tr></table></figure></p>
<h3 id="forever"><a href="#forever" class="headerlink" title="forever"></a>forever</h3><p>官网：<a href="https://github.com/foreverjs/forever" target="_blank" rel="external">https://github.com/foreverjs/forever</a><br>从功能上来看，个人感觉不如PM2全面和完善，具体的网上有很多教程和资料，就不赘述了。</p>
<h2 id="调试分析"><a href="#调试分析" class="headerlink" title="调试分析"></a>调试分析</h2><h3 id="node-inspector"><a href="#node-inspector" class="headerlink" title="node-inspector"></a>node-inspector</h3><p>这个模块提供了基于V8分析器的调试接口，配合chrome浏览器，可以直观的浏览运行时内存。<br>用于分析业务中可能的缺陷很有帮助。<br>安装并运行node-inspector<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; node --debug app.js</div><div class="line">&gt; node-inspector</div><div class="line">Node Inspector v0.12.8</div><div class="line">Visit http://127.0.0.1:8080/?port=5858 to start debugging.</div></pre></td></tr></table></figure></p>
<p>运行需要调试的项目，加“—-debug”参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; node —-debug app.js</div><div class="line">Debugger listening on [::]:5858</div></pre></td></tr></table></figure>
<p>chrome 打开  <a href="http://127.0.0.1:8080/?port=5858" target="_blank" rel="external">http://127.0.0.1:8080/?port=5858</a> 就可以看到调试界面。<br>点击“Profiles”，选择“Take Heap Snapshor” 点击 “Take Snapshot”就可以浏览运行时内存数据了。<br><img src="/img/node-take-snapshot.png" alt="Node.js Take Snapshot"></p>
<h3 id="node-memwatch"><a href="#node-memwatch" class="headerlink" title="node-memwatch"></a>node-memwatch</h3><h3 id="node-mtrace"><a href="#node-mtrace" class="headerlink" title="node-mtrace"></a>node-mtrace</h3><h3 id="node-heap-dump"><a href="#node-heap-dump" class="headerlink" title="node-heap-dump"></a>node-heap-dump</h3></div><div class="tags"><a href="/tags/node-js/">node.js</a></div><div class="post-nav"><a href="/2016/06/27/Centos7-Nginx-PHP7-MySQL5-7-Redis3-2-swoole1-8/" class="next">最小化安装Centos7 编译安装Nginx PHP7 MySQL5.7 Redis3.2 swoole1.8</a></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/断点续传/" style="font-size: 15px;">断点续传</a> <a href="/tags/Centos7/" style="font-size: 15px;">Centos7</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/MySQL5-7/" style="font-size: 15px;">MySQL5.7</a> <a href="/tags/Redis3-2/" style="font-size: 15px;">Redis3.2</a> <a href="/tags/swoole1-8/" style="font-size: 15px;">swoole1.8</a> <a href="/tags/node-js/" style="font-size: 15px;">node.js</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/10/">十月 2005</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/02/25/How-to-make-the-node-js-application-run-stably/">让Node.js程序稳定运行</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/27/Centos7-Nginx-PHP7-MySQL5-7-Redis3-2-swoole1-8/">最小化安装Centos7 编译安装Nginx PHP7 MySQL5.7 Redis3.2 swoole1.8</a></li><li class="post-list-item"><a class="post-list-link" href="/2005/10/20/PHP-breakpoint-resume/">PHP 实现文件下载的断点续传</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.2.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<a href="/atom.xml">订阅本站</a> |<span>联系博主：<a href="mailto:yuenshui@126.com" target="_blank" class="fa fa-email"> </a><a href="http://weibo.com/enshui/" target="_blank" class="fa fa-weibo"></a><a href="https://github.com/yuenshui" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">于恩水(Mustang Yu)</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> Theme </a>by<a rel="nofollow" target="_blank" href="https://github.com/chaooo"> Charles.</a></span></p></div></div></div></body></html>